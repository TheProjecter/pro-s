<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wozeze.pros.dao.target_catelog.TargetCatelogMapper">

	<insert id="insertTargetCatelog" parameterType="targetCatelog">
		<selectKey keyProperty="id" resultType="string" order="BEFORE">
			SELECT sys_guid() FROM dual 
    	</selectKey>
		INSERT INTO
		TE_TARGET_CATELOG (ID, CATELOG_NAME, DETAIL)
		VALUES
		(#{id}, #{name}, #{catelogDetail})
	</insert>
	
	<select id="queryTargetCatelogs" parameterType="queryParam" resultType="targetCatelog">
			select t.id     AS id,
       		t.catelog_name 	AS name,
      		(CASE WHEN LENGTH(t.detail) >= 15 then substr(t.detail,1,15)||'...' else t.detail end)  AS catelogDetail
  			from te_target_catelog t
  			<where>
				<if test="!all">
					<![CDATA[  			
		 			 rowid in
		      		 (select rid
		        	  from (select rownum rn, rid
		                  from (select rowid rid, id from te_target_catelog order by id desc)
		                 where rownum <= #{page.startRow} + #{page.pageSize})
		       			  where rn > #{page.startRow})
		 				order by id desc
		 			]]>
 				</if>
 			</where>
	</select>
	
	<delete id="deleteTargetCatelog" parameterType="targetCatelog">
		DELETE FROM TE_TARGET_CATELOG T WHERE T.ID = #{id}
	</delete>
	
	<select id="queryTargetCatelogById" parameterType="targetCatelog" resultType="targetCatelog">
			select t.id     AS id,
       		t.catelog_name 	AS name,
       		t.detail AS catelogDetail
       		from te_target_catelog t where t.id = #{id}
	</select>
	
	<update id="updateTargetCatelog" parameterType="targetCatelog">
		update te_target_catelog t
		set t.catelog_name = #{name},
			t.detail = #{catelogDetail}
		where t.id = #{id}
	</update>
	
</mapper>